!function(){return function t(e,r,i){function h(a,n){if(!r[a]){if(!e[a]){var l="function"==typeof require&&require;if(!n&&l)return l(a,!0);if(s)return s(a,!0);var o=new Error("Cannot find module '"+a+"'");throw o.code="MODULE_NOT_FOUND",o}var p=r[a]={exports:{}};e[a][0].call(p.exports,function(t){return h(e[a][1][t]||t)},p,p.exports,t,e,r,i)}return r[a].exports}for(var s="function"==typeof require&&require,a=0;a<i.length;a++)h(i[a]);return h}}()({1:[function(t,e,r){var i=function(t){for(var e in t)void 0!==this.properties[e]&&(this.properties[e]=t[e]);this.properties.rseed=this.properties.seed,this.root=new h([0,this.properties.trunkLength,0]),this.root.length=this.properties.initialBranchLength,this.verts=[],this.faces=[],this.normals=[],this.UV=[],this.vertsTwig=[],this.normalsTwig=[],this.facesTwig=[],this.uvsTwig=[],this.root.split(null,null,this.properties),this.createForks(),this.createTwigs(),this.doFaces(),this.calcNormals()};i.prototype.properties={clumpMax:.8,clumpMin:.5,lengthFalloffFactor:.85,lengthFalloffPower:1,branchFactor:2,radiusFalloffRate:.6,climbRate:1.5,trunkKink:0,maxRadius:.25,treeSteps:2,taperRate:.95,twistRate:13,segments:6,levels:3,sweepAmount:0,initialBranchLength:.85,trunkLength:2.5,dropAmount:0,growAmount:0,vMultiplier:.2,twigScale:2,seed:10,rseed:10,random:function(t){return t||(t=this.rseed++),Math.abs(Math.cos(t+t*t))}},i.prototype.calcNormals=function(){for(var t=this.normals,e=this.faces,r=this.verts,i=[],h=0;h<r.length;h++)i[h]=[];for(h=0;h<e.length;h++){var s=e[h],n=l(a(p(r[s[1]],r[s[2]]),p(r[s[1]],r[s[0]])));i[s[0]].push(n),i[s[1]].push(n),i[s[2]].push(n)}for(h=0;h<i.length;h++){for(var d=[0,0,0],c=i[h].length,g=0;g<c;g++)d=u(d,o(i[h][g],1/c));t[h]=d}},i.prototype.doFaces=function(t){t||(t=this.root);var e=this.properties.segments,r=this.faces,i=this.verts,h=this.UV;if(!t.parent){for(f=0;f<i.length;f++)h[f]=[0,0];var o=l(a(p(t.child0.head,t.head),p(t.child1.head,t.head))),u=l(t.head),d=Math.acos(s(o,[-1,0,0]));s(a([-1,0,0],o),u)>0&&(d=2*Math.PI-d);for(var g=Math.round(d/Math.PI/2*e),f=0;f<e;f++){var v=t.ring0[f],w=t.root[(f+g+1)%e],m=t.root[(f+g)%e],M=t.ring0[(f+1)%e];r.push([v,M,m]),r.push([M,w,m]),h[(f+g)%e]=[2*Math.abs(f/e-.5),0];var F=n(p(i[t.ring0[f]],i[t.root[(f+g)%e]]))*this.properties.vMultiplier;h[t.ring0[f]]=[2*Math.abs(f/e-.5),F],h[t.ring2[f]]=[2*Math.abs(f/e-.5),F]}}if(t.child0.ring0){var R,y,k,T;v=l(p(i[t.ring1[0]],t.head)),w=l(p(i[t.ring2[0]],t.head));for(v=c(v,l(p(t.child0.head,t.head)),0),w=c(w,l(p(t.child1.head,t.head)),0),f=0;f<e;f++){var b=l(p(i[t.child0.ring0[f]],t.child0.head)),E=s(b,v);(void 0===R||E>k)&&(k=E,R=e-f),b=l(p(i[t.child1.ring0[f]],t.child1.head)),E=s(b,w),(void 0==y||E>T)&&(T=E,y=e-f)}var S=this.properties.maxRadius/t.radius;for(f=0;f<e;f++){v=t.child0.ring0[f],w=t.ring1[(f+R+1)%e],m=t.ring1[(f+R)%e],M=t.child0.ring0[(f+1)%e],r.push([v,M,m]),r.push([M,w,m]),v=t.child1.ring0[f],w=t.ring2[(f+y+1)%e],m=t.ring2[(f+y)%e],M=t.child1.ring0[(f+1)%e],r.push([v,w,m]),r.push([v,M,w]);var x=n(p(i[t.child0.ring0[f]],i[t.ring1[(f+R)%e]]))*S,A=h[t.ring1[(f+R-1)%e]];h[t.child0.ring0[f]]=[A[0],A[1]+x*this.properties.vMultiplier],h[t.child0.ring2[f]]=[A[0],A[1]+x*this.properties.vMultiplier];var O=n(p(i[t.child1.ring0[f]],i[t.ring2[(f+y)%e]]))*S,j=h[t.ring2[(f+y-1)%e]];h[t.child1.ring0[f]]=[j[0],j[1]+O*this.properties.vMultiplier],h[t.child1.ring2[f]]=[j[0],j[1]+O*this.properties.vMultiplier]}this.doFaces(t.child0),this.doFaces(t.child1)}else for(f=0;f<e;f++){r.push([t.child0.end,t.ring1[(f+1)%e],t.ring1[f]]),r.push([t.child1.end,t.ring2[(f+1)%e],t.ring2[f]]);F=n(p(i[t.child0.end],i[t.ring1[f]]));h[t.child0.end]=[2*Math.abs(f/e-1-.5),F*this.properties.vMultiplier];F=n(p(i[t.child1.end],i[t.ring2[f]]));h[t.child1.end]=[2*Math.abs(f/e-.5),F*this.properties.vMultiplier]}},i.prototype.createTwigs=function(t){t||(t=this.root);var e=this.vertsTwig,r=this.normalsTwig,i=this.facesTwig,h=this.uvsTwig;if(t.child0)this.createTwigs(t.child0),this.createTwigs(t.child1);else{var s=l(a(p(t.parent.child0.head,t.parent.head),p(t.parent.child1.head,t.parent.head))),n=l(p(t.head,t.parent.head)),d=a(s,n),c=e.length;e.push(u(u(t.head,o(s,this.properties.twigScale)),o(n,2*this.properties.twigScale-t.length)));var g=e.length;e.push(u(u(t.head,o(s,-this.properties.twigScale)),o(n,2*this.properties.twigScale-t.length)));var f=e.length;e.push(u(u(t.head,o(s,-this.properties.twigScale)),o(n,-t.length)));var v=e.length;e.push(u(u(t.head,o(s,this.properties.twigScale)),o(n,-t.length)));var w=e.length;e.push(u(u(t.head,o(s,this.properties.twigScale)),o(n,2*this.properties.twigScale-t.length)));var m=e.length;e.push(u(u(t.head,o(s,-this.properties.twigScale)),o(n,2*this.properties.twigScale-t.length)));var M=e.length;e.push(u(u(t.head,o(s,-this.properties.twigScale)),o(n,-t.length)));var F=e.length;e.push(u(u(t.head,o(s,this.properties.twigScale)),o(n,-t.length))),i.push([c,g,f]),i.push([v,c,f]),i.push([M,m,w]),i.push([M,w,F]),d=l(a(p(e[c],e[f]),p(e[g],e[f])));var R=l(a(p(e[m],e[M]),p(e[w],e[M])));r.push(d),r.push(d),r.push(d),r.push(d),r.push(R),r.push(R),r.push(R),r.push(R),h.push([0,1]),h.push([1,1]),h.push([1,0]),h.push([0,0]),h.push([0,1]),h.push([1,1]),h.push([1,0]),h.push([0,0])}},i.prototype.createForks=function(t,e){t||(t=this.root),e||(e=this.properties.maxRadius),t.radius=e,e>t.length&&(e=t.length);var r=this.verts,i=this.properties.segments,h=2*Math.PI/i;if(!t.parent){t.root=[];for(var g=[0,1,0],f=0;f<i;f++){var v=d([-1,0,0],g,-h*f);t.root.push(r.length),r.push(o(v,e/this.properties.radiusFalloffRate))}}if(t.child0){if(t.parent)g=l(p(t.head,t.parent.head));else g=l(t.head);var w=l(p(t.head,t.child0.head)),m=l(p(t.head,t.child1.head)),M=l(a(w,m));t.tangent=M;var F=l(a(M,l(u(o(w,-1),o(m,-1))))),R=[m[0],0,m[2]],y=u(t.head,o(R,-this.properties.maxRadius/2)),k=t.ring0=[],T=t.ring1=[],b=t.ring2=[],E=this.properties.radiusFalloffRate;"trunk"!=t.child0.type&&"trunk"!=t.type||(E=1/this.properties.taperRate);var S=r.length;k.push(S),b.push(S),r.push(u(y,o(M,e*E)));var x=r.length-1,A=d(M,m,1.57),O=l(a(M,g)),j=1/s(A,O);for(f=1;f<i/2;f++){v=d(M,m,h*f);k.push(x+f),b.push(x+f),v=c(v,O,j),r.push(u(y,o(v,e*E)))}var H=r.length;k.push(H),T.push(H),r.push(u(y,o(M,-e*E)));for(f=i/2+1;f<i;f++){v=d(M,w,h*f);k.push(r.length),T.push(r.length),r.push(u(y,o(v,e*E)))}T.push(S),b.push(H);for(x=r.length-1,f=1;f<i/2;f++){v=d(M,F,h*f);T.push(x+f),b.push(x+(i/2-f));var D=o(v,e*E);r.push(u(y,D))}n(p(t.head,t.child0.head)),n(p(t.head,t.child1.head));var L=1*e*this.properties.radiusFalloffRate,G=1*e*this.properties.radiusFalloffRate;"trunk"==t.child0.type&&(L=e*this.properties.taperRate),this.createForks(t.child0,L),this.createForks(t.child1,G)}else t.end=r.length,r.push(t.head)};var h=function(t,e){this.head=t,this.parent=e};h.prototype.child0=null,h.prototype.child1=null,h.prototype.parent=null,h.prototype.head=null,h.prototype.length=1,h.prototype.mirrorBranch=function(t,e,r){var i=a(e,a(t,e)),h=r.branchFactor*s(i,t);return[t[0]-i[0]*h,t[1]-i[1]*h,t[2]-i[2]*h]},h.prototype.split=function(t,e,r,i,s){void 0==i&&(i=1),void 0==s&&(s=1),void 0==t&&(t=r.levels),void 0==e&&(e=r.treeSteps);var n,d=r.levels-t;this.parent?n=this.parent.head:(n=[0,0,0],this.type="trunk");var c=this.head,g=l(p(c,n)),f=a(g,[g[2],g[0],g[1]]),v=a(g,f),w=r.random(10*d+5*i+s+r.seed),m=(r.random(10*d+5*i+s+1+r.seed),r.clumpMax),M=r.clumpMin,F=u(o(f,w),o(v,1-w));w>.5&&(F=o(F,-1));var R=(m-M)*w+M,y=l(u(o(F,1-R),o(g,R))),k=this.mirrorBranch(y,g,r);if(w>.5){var T=y;y=k,k=T}if(e>0){var b=e/r.treeSteps*2*Math.PI*r.twistRate;k=l([Math.sin(b),w,Math.cos(b)])}var E=t*t/(r.levels*r.levels)*r.growAmount,S=d*r.dropAmount,x=d*r.sweepAmount;y=l(u(y,[x,S+E,0])),k=l(u(k,[x,S+E,0]));var A=u(c,o(y,this.length)),O=u(c,o(k,this.length));this.child0=new h(A,this),this.child1=new h(O,this),this.child0.length=Math.pow(this.length,r.lengthFalloffPower)*r.lengthFalloffFactor,this.child1.length=Math.pow(this.length,r.lengthFalloffPower)*r.lengthFalloffFactor,t>0&&(e>0?(this.child0.head=u(this.head,[2*(w-.5)*r.trunkKink,r.climbRate,2*(w-.5)*r.trunkKink]),this.child0.type="trunk",this.child0.length=this.length*r.taperRate,this.child0.split(t,e-1,r,i+1,s)):this.child0.split(t-1,0,r,i+1,s),this.child1.split(t-1,0,r,i,s+1))};var s=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},a=function(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]},n=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])},l=function(t){var e=n(t);return o(t,1/e)},o=function(t,e){return[t[0]*e,t[1]*e,t[2]*e]},p=function(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]},u=function(t,e){return[t[0]+e[0],t[1]+e[1],t[2]+e[2]]},d=function(t,e,r){var i=Math.cos(r),h=Math.sin(r);return u(u(o(t,i),o(a(e,t),h)),o(e,s(e,t)*(1-i)))},c=function(t,e,r){var i=s(t,e),h=o(e,i*r-i);return u(t,h)};i.flattenArray=function(t){for(var e=[],r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++)e.push(t[r][i]);return e},e.exports=i},{}],2:[function(t,e,r){const i=t("../lib/proctree.js");AFRAME.registerComponent("proctree",{schema:{seed:{type:"int",default:262},segments:{type:"int",default:6},levels:{type:"int",default:5},twigScale:{default:.39},initialBranchLength:{default:.49},lengthFalloffFactor:{default:.85},lengthFalloffPower:{default:.99},clumpMax:{default:.454},clumpMin:{default:.404},branchFactor:{default:2.45},dropAmount:{default:-.1},growAmount:{default:.235},sweepAmount:{default:.01},maxRadius:{default:.139},climbRate:{default:.371},trunkKink:{default:.093},treeSteps:{type:"int",default:5},taperRate:{default:.947},radiusFalloffRate:{default:.73},twistRate:{default:3.02},trunkColor:{type:"color",default:"brown"},trunkLength:{default:2.4},vMultiplier:{default:2.36},generateTwigs:{default:!0}},init(){this.trunkMat=new THREE.MeshLambertMaterial({color:"brown"}),this.trunkMat.name="trunk",this.twigsMat=new THREE.MeshLambertMaterial({color:"green"}),this.twigsMat.name="twigs"},update(t){let e=Object.assign({},this.data);e.seed<0&&(e.seed=23748923*Math.random());let r=new i(e),h=this.newGeo(r.verts,r.faces,r.UV);h=(new THREE.BufferGeometry).fromGeometry(h);let s=this.el.getObject3D("trunk")?this.el.getObject3D("trunk").material:this.trunkMat;this.trunkMat.color.setStyle(this.data.trunkColor);let a=new THREE.Mesh(h,s);if(this.el.setObject3D("trunk",a),this.data.generateTwigs){let t=this.newGeo(r.vertsTwig,r.facesTwig,r.uvsTwig);t=(new THREE.BufferGeometry).fromGeometry(t);let e=this.el.getObject3D("mesh")?this.el.getObject3D("mesh").material:this.twigsMat,i=new THREE.Mesh(t,e);this.el.setObject3D("mesh",i)}else this.el.removeObject3D("mesh",twigsMesh)},newGeo(t,e,r){let i=new THREE.Geometry;return i.vertices=t.map(t=>new THREE.Vector3(t[0],t[1],t[2])),i.faces=e.map(t=>new THREE.Face3(t[0],t[1],t[2])),i.faceVertexUvs[0]=e.map(t=>t.map(t=>new THREE.Vector2(r[t][0],r[t][1]))),i.computeFaceNormals(),i.computeVertexNormals(),i}})},{"../lib/proctree.js":1}]},{},[2]);